<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MNIST Digit Recognizer</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    function MNISTDrawer() {
      const canvasRef = useRef(null);
      const [isDrawing, setIsDrawing] = useState(false);
      const [prediction, setPrediction] = useState(null);
      const [serverUrl, setServerUrl] = useState('http://localhost:8080/predict');
      const [isLoading, setIsLoading] = useState(false);
      const [error, setError] = useState(null);

      useEffect(() => {
        const canvas = canvasRef.current;
        if (canvas) {
          const ctx = canvas.getContext('2d');
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.strokeStyle = 'black';
          ctx.lineWidth = 20;
          ctx.lineCap = 'round';
          ctx.lineJoin = 'round';
        }
      }, []);

      const startDrawing = (e) => {
        setIsDrawing(true);
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        ctx.beginPath();
        ctx.moveTo(x, y);
      };

      const draw = (e) => {
        if (!isDrawing) return;
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        ctx.lineTo(x, y);
        ctx.stroke();
      };

      const stopDrawing = () => {
        setIsDrawing(false);
      };

      const clearCanvas = () => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        setPrediction(null);
        setError(null);
      };

      const getImageData = () => {
        const canvas = canvasRef.current;
        const ctx = canvas.getContext('2d');
        
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = 28;
        tempCanvas.height = 28;
        const tempCtx = tempCanvas.getContext('2d');
        
        tempCtx.drawImage(canvas, 0, 0, 28, 28);
        
        const imageData = tempCtx.getImageData(0, 0, 28, 28);
        const pixels = imageData.data;
        
        const normalized = [];
        for (let i = 0; i < pixels.length; i += 4) {
          const avg = (pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3;
          normalized.push(1.0 - (avg / 255.0));
        }
        
        return normalized;
      };

      const sendToServer = async () => {
        if (!serverUrl) {
          setError('Please enter a server URL');
          return;
        }

        setIsLoading(true);
        setError(null);
        
        try {
          const imageData = getImageData();
          const response = await fetch(serverUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ image: imageData }),
          });

          if (!response.ok) {
            throw new Error(`Server responded with ${response.status}`);
          }

          const result = await response.json();
          setPrediction(result);
        } catch (err) {
          setError(err.message);
        } finally {
          setIsLoading(false);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
          <div className="max-w-2xl mx-auto">
            <h1 className="text-4xl font-bold text-center mb-2 text-gray-800">
              MNIST Digit Recognizer
            </h1>
            <p className="text-center text-gray-600 mb-8">
              Draw a digit (0-9) and let the model predict it
            </p>

            <div className="bg-white rounded-lg shadow-xl p-6 mb-6">
              <div className="mb-4">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  Server URL
                </label>
                <input
                  type="text"
                  value={serverUrl}
                  onChange={(e) => setServerUrl(e.target.value)}
                  placeholder="http://localhost:5000/predict"
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                />
              </div>

              <div className="flex justify-center mb-4">
                <canvas
                  ref={canvasRef}
                  width={280}
                  height={280}
                  onMouseDown={startDrawing}
                  onMouseMove={draw}
                  onMouseUp={stopDrawing}
                  onMouseLeave={stopDrawing}
                  className="border-4 border-gray-300 rounded-lg cursor-crosshair shadow-inner"
                  style={{ touchAction: 'none' }}
                />
              </div>

              <div className="flex gap-3 justify-center mb-6">
                <button
                  onClick={clearCanvas}
                  className="flex items-center gap-2 px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors font-medium"
                >
                  Clear
                </button>
                <button
                  onClick={sendToServer}
                  disabled={isLoading}
                  className="flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-medium disabled:bg-indigo-300 disabled:cursor-not-allowed"
                >
                  {isLoading ? 'Predicting...' : 'Predict'}
                </button>
              </div>

              {error && (
                <div className="p-4 bg-red-50 border border-red-200 rounded-lg text-red-700">
                  <strong>Error:</strong> {error}
                </div>
              )}

              {prediction && (
                <div className="p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-lg">
                  <h3 className="text-lg font-semibold text-gray-800 mb-2">
                    Prediction Result:
                  </h3>
                  <pre className="bg-white p-4 rounded border border-gray-200 overflow-auto text-sm">
                    {JSON.stringify(prediction, null, 2)}
                  </pre>
                </div>
              )}
            </div>

            <div className="bg-white rounded-lg shadow-md p-4 text-sm text-gray-600">
              <h4 className="font-semibold mb-2">How it works:</h4>
              <ul className="list-disc list-inside space-y-1">
                <li>Draw a digit (0-9) on the canvas</li>
                <li>The image is scaled to 28Ã—28 pixels (MNIST format)</li>
                <li>Pixels are normalized to 0.0-1.0 (0=white, 1=black)</li>
                <li>The 784 values are sent to your server as a flat array</li>
              </ul>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<MNISTDrawer />, document.getElementById('root'));
  </script>
</body>
</html>